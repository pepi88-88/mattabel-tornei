import { NextRequest, NextResponse } from 'next/server'; import { supabaseAdmin } from '@/lib/supabaseServer'
export const runtime='nodejs'
export async function GET(req:NextRequest){ const s=supabaseAdmin(); const sp=new URL(req.url).searchParams; const t=sp.get('tournament_id'); const {data:regs,error}=await s.from('registrations').select('id,order_index,partner_status,team_id').eq('tournament_id',t).order('order_index'); if(error) return NextResponse.json({error:error.message},{status:500}); const out=[] as any[]; for(const r of regs||[]){ const {data:team}=await s.from('teams').select('player_a,player_b').eq('id',r.team_id).single(); const {data:a}=await s.from('players').select('first_name,last_name').eq('id',team?.player_a).single(); const {data:b}=await s.from('players').select('first_name,last_name').eq('id',team?.player_b).single(); const label=`${{}}`.toString(); out.push({id:r.id,label:`${a?.last_name ?? ''} ${a?.first_name ?? ''} â€” ${b?.last_name ?? (r.partner_status?.toUpperCase()) ?? ''}`}) } return NextResponse.json({items:out}) }
